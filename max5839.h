#ifndef MAX5839_H_INCLUDED
#define MAX5839_H_INCLUDED

/*	max5839 driver
	pins not connected
	wr: tied to ground

	pins connected
	data pins
	latch: tied together
	a0/a1/a2: tied together individually
	cs: user specified
 */

//hardware configuration
#define MAX5839MSB_PORT			PORTC
#define MAX5839MSB_DDR			DDRC
#define MAX5839MSB				0x1f	//highest 5 bits

#define MAX5839LSB_PORT			PORTB
#define MAX5839LSB_DDR			DDRB
#define MAX5839LSB				0xff	//lowest 8 bits

#define MAX5839DAT_OUT(msb_lsb)	{MAX5839MSB_PORT = ((MAX5839MSB_PORT) & ~(MAX5839MSB)) | (((msb_lsb) >> 8) & (MAX5839MSB)); MAX5839LSB_PORT = (msb_lsb);}

#define MAX5839CTRL_PORT		PORTD
#define MAX5839CTRL_DDR			DDRD
#define MAX5839CTRL_LDAC		(1<<1)
#define MAX5839CTRL_A0			(1<<2)
#define MAX5839CTRL_A1			(1<<3)
#define MAX5839CTRL_A2			(1<<4)

//end hardware configuration

//select chips
#define max5839_select(cs)		{max5839_deselect(cs); IO_CLR(MAX5839CTRL_PORT, cs);}
#define max5839_deselect(cs)	{IO_SET(MAX5839CTRL_PORT, cs); IO_OUT(MAX5839CTRL_DDR, cs);}

//select individual dac
#define max5839_daca()			{IO_CLR(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_CLR(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_CLR(MAX5839CTRL_PORT, MAX5839CTRL_A0);}
#define max5839_dacb()			{IO_CLR(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_CLR(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_SET(MAX5839CTRL_PORT, MAX5839CTRL_A0);}
#define max5839_dacc()			{IO_CLR(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_SET(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_CLR(MAX5839CTRL_PORT, MAX5839CTRL_A0);}
#define max5839_dacd()			{IO_CLR(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_SET(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_SET(MAX5839CTRL_PORT, MAX5839CTRL_A0);}
#define max5839_dace()			{IO_SET(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_CLR(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_CLR(MAX5839CTRL_PORT, MAX5839CTRL_A0);}
#define max5839_dacf()			{IO_SET(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_CLR(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_SET(MAX5839CTRL_PORT, MAX5839CTRL_A0);}
#define max5839_dacg()			{IO_SET(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_SET(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_CLR(MAX5839CTRL_PORT, MAX5839CTRL_A0);}
#define max5839_dach()			{IO_SET(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_SET(MAX5839CTRL_PORT, MAX5839CTRL_A0); IO_SET(MAX5839CTRL_PORT, MAX5839CTRL_A0);}

#define max5839_write(val)		MAX5839DAT_OUT(val)

//operate the latch
//need to initialize it as well
#define max5839_latch()			{IO_CLR(MAX5839CTRL_PORT, MAX5839CTRL_LDAC); IO_OUT(MAX5839CTRL_DDR, MAX5839CTRL_LDAC); IO_SET(MAX5839CTRL_PORT, MAX5839CTRL_LDAC);}

//initialize the pins
void max5839_init(void);

#endif // MAX5839_H_INCLUDED
